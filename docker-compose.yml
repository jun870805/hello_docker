version: '3.8'

services:
  # ä½ çš„ Python æ©Ÿå™¨äºº
  bot:
    build: .
    container_name: ticket-bot
    volumes:
      - .:/app
    environment:
      - SELENIUM_HOST=http://chrome:4444/wd/hub
      - TZ=Asia/Taipei # åŒæ­¥æ™‚å€
    depends_on:
      - chrome
    # ä½¿ç”¨ python -u ç¢ºä¿ log ç«‹å³å°å‡º
    command: python -u main.py

  # Chrome ç€è¦½å™¨ + NoVNC
  chrome:
    image: selenium/standalone-chrome:latest
    container_name: chrome-browser
    shm_size: "2gb" # é˜²æ­¢è¨˜æ†¶é«”ä¸è¶³å´©æ½°
    ports:
      - "4444:4444"
      - "7900:7900" # NoVNC ç¶²é å…¥å£
    environment:
      - SE_NODE_MAX_SESSIONS=1
      - SE_VNC_NO_PASSWORD=1 # å…å¯†ç¢¼ç™»å…¥ NoVNC
      - TZ=Asia/Taipei       # è¨­å®šç€è¦½å™¨å…§éƒ¨æ™‚å€
    volumes:
      # ğŸ”¥ é—œéµï¼šæŠŠ Chrome çš„è¨­å®šæª”å­˜åˆ° Linux æœ¬æ©Ÿï¼Œå¯¦ç¾ã€Œé¤Šè™Ÿã€
      - ./data/profile:/chrome-profile
      - ./data/downloads:/home/seluser/Downloads
